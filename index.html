<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¨¸ì‹ ëŸ¬ë„ˆ - Machine Learner | AI ì£¼ì‹íˆ¬ì</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9/marked.min.js"></script>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="#hero" class="nav-brand">
                <img src="logo.png" alt="Machine Learner Logo" class="nav-logo">
                <span class="nav-brand-text">ë¨¸ì‹ ëŸ¬ë„ˆ</span>
            </a>

            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <div class="nav-links">
                <a href="#market" class="nav-link">ì£¼ì‹ì‹œì¥</a>
                <a href="#downloads" class="nav-link">ë°ì´í„° ë‹¤ìš´ë¡œë“œ</a>
                <a href="#ai-prompts" class="nav-link">AI í”„ë¡¬í”„íŠ¸</a>
                <a href="#book-updates" class="nav-link">ë„ì„œê°œì •</a>
                <a href="#ai-updates" class="nav-link">AI ì†Œì‹</a>
                <a href="#insights" class="nav-link">íˆ¬ìë©”ëª¨</a>
                <a href="#contact" class="nav-link">Contact</a>
            </div>
        </div>
    </nav>

    <main>
        <!-- íˆì–´ë¡œ ì„¹ì…˜ (ìµœìƒë‹¨) -->
        <section id="hero" class="hero">
            <div class="container">
                <h2>AI ì£¼ì‹íˆ¬ì</h2>
                <p class="subtitle">
                    ë¨¸ì‹ ëŸ¬ë‹ê³¼ ì¸ê³µì§€ëŠ¥ì„ í™œìš©í•œ ë°ì´í„° ê¸°ë°˜ íˆ¬ì ì „ëµ êµ¬ì¶•<br>
                    9ê°œ ì±•í„°ë¡œ ë°°ìš°ëŠ” ì‹¤ì „ AI íˆ¬ì ì‹œìŠ¤í…œ
                </p>
            </div>
        </section>

        <!-- ì£¼ì‹ì‹œì¥ ì„¹ì…˜ -->
        <section id="market" class="market">
            <div class="container">
                <h3>ì£¼ì‹ì‹œì¥</h3>
                <p class="section-description">í•œêµ­ê³¼ ë¯¸êµ­ ì£¼ìš” ì§€ìˆ˜ì˜ ìµœê·¼ 1ë…„ íë¦„ì„ í™•ì¸í•˜ì„¸ìš”.</p>

                <div class="market-grid">
                    <!-- KOSPI -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label korea">í•œêµ­</span>
                                <h4 class="chart-name">KOSPI</h4>
                            </div>
                            <div class="chart-stats" id="kospiStats">
                                <span class="chart-price" id="kospiPrice">â€”</span>
                                <span class="chart-change" id="kospiChange">â€”</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="kospiChart"></canvas>
                            <div class="chart-loading" id="kospiLoading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                        <div class="chart-footer" id="kospiDate">â€”</div>
                    </div>

                    <!-- S&P 500 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label us">ë¯¸êµ­</span>
                                <h4 class="chart-name">S&P 500</h4>
                            </div>
                            <div class="chart-stats" id="sp500Stats">
                                <span class="chart-price" id="sp500Price">â€”</span>
                                <span class="chart-change" id="sp500Change">â€”</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="sp500Chart"></canvas>
                            <div class="chart-loading" id="sp500Loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                        <div class="chart-footer" id="sp500Date">â€”</div>
                    </div>

                    <!-- KOSDAQ -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label korea">í•œêµ­</span>
                                <h4 class="chart-name">KOSDAQ</h4>
                            </div>
                            <div class="chart-stats" id="kosdaqStats">
                                <span class="chart-price" id="kosdaqPrice">â€”</span>
                                <span class="chart-change" id="kosdaqChange">â€”</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="kosdaqChart"></canvas>
                            <div class="chart-loading" id="kosdaqLoading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                        <div class="chart-footer" id="kosdaqDate">â€”</div>
                    </div>

                    <!-- QQQ -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label us">ë¯¸êµ­</span>
                                <h4 class="chart-name">QQQ</h4>
                            </div>
                            <div class="chart-stats" id="qqqStats">
                                <span class="chart-price" id="qqqPrice">â€”</span>
                                <span class="chart-change" id="qqqChange">â€”</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="qqqChart"></canvas>
                            <div class="chart-loading" id="qqqLoading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                        <div class="chart-footer" id="qqqDate">â€”</div>
                    </div>
                </div>

                <p class="market-note">* ë°ì´í„° ì¶œì²˜: Yahoo Finance. ì‹¤ì‹œê°„ì´ ì•„ë‹ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </section>

        <!-- ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ -->
        <section id="downloads" class="downloads">
            <div class="container">
                <h3>ë°ì´í„° ë‹¤ìš´ë¡œë“œ</h3>
                <p class="download-description">
                    ì±…ì—ì„œ ì‚¬ìš©ëœ ë°ì´í„°ì…‹ê³¼ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>

                <div class="download-grid">
                    <div class="download-card">
                        <h4>ğŸ“š ì¥ë³„ ì‹¤ìŠµ ì œê³µ</h4>
                        <p>9ê°œ ì±•í„°ë³„ ë°ì´í„° & AI í”„ë¡¬í”„íŠ¸</p>
                        <a href="chapters.html" class="download-btn">í•™ìŠµ ì‹œì‘</a>
                    </div>

                    <div class="download-card">
                        <h4>ğŸ“Š í•œêµ­ ì£¼ì‹ ê°€ê²© ë°ì´í„°</h4>
                        <p>2,500+ ì¢…ëª©ì˜ OHLCV ë°ì´í„° (ì›”ê°„ / ì¼ê°„)</p>
                        <a href="krx-ohlcv.html" class="download-btn">ë‹¤ìš´ë¡œë“œ</a>
                    </div>

                    <div class="download-card">
                        <h4>ğŸ“ˆ í•œêµ­ ì£¼ì‹ í€€íŠ¸ ë°ì´í„°</h4>
                        <p>ì¬ë¬´ì œí‘œ, ë°¸ë¥˜ì—ì´ì…˜ ë“± (ì¤€ë¹„ì¤‘)</p>
                        <span class="badge-coming-soon">ì¤€ë¹„ì¤‘</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ -->
        <section id="ai-prompts" class="ai-prompts">
            <div class="container">
                <h3>AI í”„ë¡¬í”„íŠ¸</h3>
                <p class="section-description">
                    ê° ì±•í„°ë³„ AI í•™ìŠµì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                </p>

                <div class="prompt-grid">
                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 1-3</span>
                        <h4>ê¸°ì´ˆ & ë°ì´í„° ìˆ˜ì§‘</h4>
                        <p>ìœ¡í•˜ì›ì¹™, ì˜ì‚¬ê²°ì •, í˜¸ì¬ì•…ì¬</p>
                        <div class="prompt-meta">
                            <span>ğŸ’¬ 9ê°œ í”„ë¡¬í”„íŠ¸</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">í”„ë¡¬í”„íŠ¸ ë³´ê¸° â†’</a>
                    </div>

                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 4-6</span>
                        <h4>AI ëª¨ë¸ë§ & í¬íŠ¸í´ë¦¬ì˜¤</h4>
                        <p>ì¬ë¬´ì œí‘œ, íˆ¬ìë©˜í† , ì•ˆì „ë§ˆì§„</p>
                        <div class="prompt-meta">
                            <span>ğŸ’¬ 12ê°œ í”„ë¡¬í”„íŠ¸</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">í”„ë¡¬í”„íŠ¸ ë³´ê¸° â†’</a>
                    </div>

                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 7-9</span>
                        <h4>ê³ ê¸‰ ë¶„ì„ & ì‹œìŠ¤í…œ êµ¬ì¶•</h4>
                        <p>ë”¥ë¦¬ì„œì¹˜, ë°±í…ŒìŠ¤íŠ¸, ì—ì´ì „íŠ¸</p>
                        <div class="prompt-meta">
                            <span>ğŸ’¬ 14ê°œ í”„ë¡¬í”„íŠ¸</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">í”„ë¡¬í”„íŠ¸ ë³´ê¸° â†’</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì‹¤ì‹œê°„ ë„ì„œê°œì • ì„¹ì…˜ -->
        <section id="book-updates" class="book-updates">
            <div class="container">
                <h3>ë„ì„œê°œì •</h3>
                <p class="section-description">
                    ë„ì„œì˜ ìµœì‹  ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”.
                </p>

                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">2025.01.15</div>
                        <div class="timeline-content">
                            <h4>Chapter 3 í˜¸ì¬ì•…ì¬ ì„¹ì…˜ ì—…ë°ì´íŠ¸</h4>
                            <p>ë‰´ìŠ¤ ê°ì„±ë¶„ì„ í”„ë¡¬í”„íŠ¸ ì¶”ê°€ ë° ì˜ˆì œ ì½”ë“œ ê°œì„ </p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2024.12.20</div>
                        <div class="timeline-content">
                            <h4>ìƒˆë¡œìš´ AI í”„ë¡¬í”„íŠ¸ ì¶”ê°€</h4>
                            <p>ì „ ì±•í„°ì— ChatGPT/Claude í™œìš© í”„ë¡¬í”„íŠ¸ 10ê°œ ì¶”ê°€</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2024.11.01</div>
                        <div class="timeline-content">
                            <h4>ì´ˆíŒ ì¶œê°„</h4>
                            <p>ë¨¸ì‹ ëŸ¬ë„ˆ - AI ì£¼ì‹íˆ¬ì ë„ì„œ ì¶œê°„</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI ì†Œì‹ ì„¹ì…˜ -->
        <section id="ai-updates" class="ai-updates">
            <div class="container">
                <h3>AI ì†Œì‹</h3>
                <p class="section-description">
                    ìµœì‹  AI ê¸°ìˆ ê³¼ ëª¨ë¸ ì—…ë°ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                </p>

                <div class="update-list">
                    <div class="update-item">
                        <span class="date">2025.01</span>
                        <span class="content">GPT-4 Turbo í”„ë¡¬í”„íŠ¸ ìµœì í™” ê°€ì´ë“œ ì¶”ê°€</span>
                    </div>
                    <div class="update-item">
                        <span class="date">2024.12</span>
                        <span class="content">Claude 3.5 Sonnetì„ í™œìš©í•œ ì¬ë¬´ì œí‘œ ë¶„ì„ ì˜ˆì œ</span>
                    </div>
                    <div class="update-item">
                        <span class="date">2024.11</span>
                        <span class="content">ì›¹ì‚¬ì´íŠ¸ ì˜¤í”ˆ</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- íˆ¬ìë©”ëª¨ ì„¹ì…˜ -->
        <section id="insights" class="insights">
            <div class="container">
                <div class="insights-header">
                    <div>
                        <h3>íˆ¬ìë©”ëª¨</h3>
                        <p class="section-description">
                            AI ì£¼ì‹íˆ¬ì ì „ë¬¸ê°€ì˜ ë…¸í•˜ìš°ì™€ ì¸ì‚¬ì´íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    <div class="insights-header-actions">
                        <button id="adminNewPostBtn" class="admin-new-btn" style="display:none" onclick="openPostEditor()">+ ìƒˆ ê¸€ ì“°ê¸°</button>
                        <button id="adminLockBtn" class="admin-lock-btn" title="ê´€ë¦¬ì ë¡œê·¸ì¸" onclick="openAdminLogin()">ğŸ”’</button>
                    </div>
                </div>

                <!-- ê¸€ ëª©ë¡ (ë™ì  ë Œë”ë§) -->
                <div class="insights-grid" id="insightsGrid">
                    <div class="insights-loading">ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </section>

        <!-- â•â•â• ê¸€ ì½ê¸° ëª¨ë‹¬ â•â•â• -->
        <div id="postReadModal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeReadModal()">
            <div class="modal-box modal-read">
                <button class="modal-close" onclick="closeReadModal()">âœ•</button>
                <div id="postReadContent"></div>
            </div>
        </div>

        <!-- â•â•â• ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ â•â•â• -->
        <div id="adminLoginModal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeAdminLogin()">
            <div class="modal-box modal-login">
                <h4>ê´€ë¦¬ì ë¡œê·¸ì¸</h4>
                <div id="adminLoginStep1">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="adminPwInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeydown="if(event.key==='Enter')verifyPassword()">
                    <div id="adminPwError" class="admin-error" style="display:none">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
                    <div class="modal-actions">
                        <button onclick="verifyPassword()" class="btn-primary">í™•ì¸</button>
                        <button onclick="closeAdminLogin()" class="btn-secondary">ì·¨ì†Œ</button>
                    </div>
                </div>
                <div id="adminLoginStep2" style="display:none">
                    <p class="admin-pat-desc">GitHub Personal Access Token (PAT)ì„ ì…ë ¥í•˜ì„¸ìš”.<br>
                    <small>ë°œê¸‰: GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens<br>ê¶Œí•œ: Contents (Read &amp; Write)</small></p>
                    <label>GitHub PAT</label>
                    <input type="password" id="adminPatInput" placeholder="ghp_xxxxxxxxxxxx" onkeydown="if(event.key==='Enter')loginWithPat()">
                    <label style="margin-top:10px">GitHub ì €ì¥ì†Œ (owner/repo)</label>
                    <input type="text" id="adminRepoInput" placeholder="ì˜ˆ: username/home_page_ml" value="" onkeydown="if(event.key==='Enter')loginWithPat()">
                    <div id="adminPatError" class="admin-error" style="display:none">PAT ë˜ëŠ” ì €ì¥ì†Œ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”.</div>
                    <div class="modal-actions">
                        <button onclick="loginWithPat()" class="btn-primary">ë¡œê·¸ì¸</button>
                        <button onclick="closeAdminLogin()" class="btn-secondary">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- â•â•â• ê¸€ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ â•â•â• -->
        <div id="postEditorModal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closePostEditor()">
            <div class="modal-box modal-editor">
                <button class="modal-close" onclick="closePostEditor()">âœ•</button>
                <h4 id="editorTitle">ìƒˆ ê¸€ ì“°ê¸°</h4>
                <input type="hidden" id="editPostId">
                <div class="editor-row">
                    <div class="editor-field" style="flex:1">
                        <label>ì´ëª¨ì§€</label>
                        <input type="text" id="editIcon" value="ğŸ“" maxlength="4" style="width:60px;text-align:center;font-size:1.4rem">
                    </div>
                    <div class="editor-field" style="flex:3">
                        <label>íƒœê·¸</label>
                        <input type="text" id="editTag" placeholder="ì˜ˆ: íˆ¬ìì „ëµ" maxlength="20">
                    </div>
                </div>
                <div class="editor-field">
                    <label>ì œëª©</label>
                    <input type="text" id="editTitleInput" placeholder="ê¸€ ì œëª©" maxlength="100">
                </div>
                <div class="editor-field">
                    <label>ë³¸ë¬¸ (ë§ˆí¬ë‹¤ìš´ ì§€ì›)</label>
                    <div class="editor-tabs">
                        <button class="editor-tab active" id="tabWrite" onclick="switchEditorTab('write')">âœï¸ ì‘ì„±</button>
                        <button class="editor-tab" id="tabPreview" onclick="switchEditorTab('preview')">ğŸ‘ ë¯¸ë¦¬ë³´ê¸°</button>
                    </div>
                    <textarea id="editContent" rows="14" placeholder="# ì œëª©&#10;&#10;ë³¸ë¬¸ì„ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
                    <div id="editPreview" class="editor-preview" style="display:none"></div>
                </div>
                <div id="editorSaveError" class="admin-error" style="display:none"></div>
                <div class="modal-actions">
                    <button onclick="savePost()" class="btn-primary" id="editorSaveBtn">ì €ì¥ (GitHub ì—…ë¡œë“œ)</button>
                    <button onclick="closePostEditor()" class="btn-secondary">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <!-- â•â•â• ì‚­ì œ í™•ì¸ ëª¨ë‹¬ â•â•â• -->
        <div id="deleteConfirmModal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeDeleteConfirm()">
            <div class="modal-box modal-confirm">
                <h4>ê¸€ ì‚­ì œ</h4>
                <p id="deleteConfirmMsg">ì´ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div class="modal-actions">
                    <button onclick="confirmDelete()" class="btn-danger">ì‚­ì œ</button>
                    <button onclick="closeDeleteConfirm()" class="btn-secondary">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <!-- Contact ì„¹ì…˜ -->
        <section id="contact" class="contact">
            <div class="container">
                <h3>Contact</h3>
                <p class="section-description">
                    ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½í•´ì£¼ì„¸ìš”.
                </p>

                <div class="contact-card">
                    <div class="contact-icon">âœ‰ï¸</div>
                    <h4>ì´ë©”ì¼ ë¬¸ì˜</h4>
                    <p>ë°ì´í„°, ë„ì„œ, ê°•ì˜ ê´€ë ¨ ë¬¸ì˜ëŠ” ì´ë©”ì¼ë¡œ ë³´ë‚´ì£¼ì„¸ìš”.</p>
                    <a href="mailto:machinelearner@example.com" class="contact-btn">machinelearner@example.com</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 ë¨¸ì‹ ëŸ¬ë„ˆ (Machine Learner). All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         íˆ¬ìë©”ëª¨ â€” ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ ê¸€ì“°ê¸° ì‹œìŠ¤í…œ
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì„¤ì •: ë¹„ë°€ë²ˆí˜¸ SHA-256 í•´ì‹œ (ì•„ë˜ SETUP ì•ˆë‚´ ì°¸ê³ )
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // *** ì•„ì§ ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ ***
    // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì •í•˜ê³  Claudeì—ê²Œ
    // "íˆ¬ìë©”ëª¨ ë¹„ë°€ë²ˆí˜¸ë¥¼ [ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸]ë¡œ ì„¤ì •í•´ì¤˜" ë¼ê³  í•˜ë©´
    // ì•„ë˜ ADMIN_PW_HASH ê°’ì„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•´ ë“œë¦½ë‹ˆë‹¤.
    const ADMIN_PW_HASH = '80c60714d8f63be704d3dafdabc755301422b1ec8588b7e36680ff5e5258cffb';

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒíƒœ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let isAdmin = false;
    let adminPat = null;
    let adminRepo = null;
    let allPosts = [];
    let deleteTargetId = null;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // SHA-256 í•´ì‹œ (Web Crypto API)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function sha256(message) {
        const msgBuffer = new TextEncoder().encode(message);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // posts.json ë¡œë“œ & ë Œë”ë§
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadPosts() {
        const grid = document.getElementById('insightsGrid');
        try {
            const res = await fetch('data/posts.json?t=' + Date.now());
            if (!res.ok) throw new Error('ë¡œë“œ ì‹¤íŒ¨');
            allPosts = await res.json();
            renderPosts();
        } catch (e) {
            grid.innerHTML = '<p style="color:#999;text-align:center;padding:2rem">ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
        }
    }

    function renderPosts() {
        const grid = document.getElementById('insightsGrid');
        if (!allPosts || allPosts.length === 0) {
            grid.innerHTML = '<p style="color:#999;text-align:center;padding:2rem">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        // ìµœì‹ ìˆœ ì •ë ¬
        const sorted = [...allPosts].sort((a, b) => b.id - a.id);

        grid.innerHTML = sorted.map(post => {
            const preview = (post.content || '')
                .replace(/#+\s*/g, '').replace(/\*\*/g, '').replace(/`/g, '')
                .slice(0, 80) + 'â€¦';
            const adminBtns = isAdmin ? `
                <div class="admin-card-btns">
                    <button class="btn-edit" onclick="event.stopPropagation();openPostEditor('${post.id}')">ìˆ˜ì •</button>
                    <button class="btn-delete" onclick="event.stopPropagation();openDeleteConfirm('${post.id}','${escapeHtml(post.title)}')">ì‚­ì œ</button>
                </div>` : '';
            return `
            <div class="insight-card" onclick="openReadModal('${post.id}')">
                ${adminBtns}
                <div class="insight-icon">${post.icon || 'ğŸ“'}</div>
                <h4>${escapeHtml(post.title)}</h4>
                <p>${escapeHtml(preview)}</p>
                <div class="insight-footer">
                    <span class="insight-tag">${escapeHtml(post.tag || '')}</span>
                    <span class="insight-read-time">${post.date || ''}</span>
                </div>
            </div>`;
        }).join('');
    }

    function escapeHtml(s) {
        return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê¸€ ì½ê¸° ëª¨ë‹¬
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openReadModal(id) {
        const post = allPosts.find(p => String(p.id) === String(id));
        if (!post) return;
        const html = marked.parse(post.content || '');
        document.getElementById('postReadContent').innerHTML =
            `<h2 style="margin-top:0">${escapeHtml(post.title)}</h2>
             <div style="margin-bottom:1rem">
                 <span class="insight-tag">${escapeHtml(post.tag||'')}</span>
                 <span style="color:#aaa;font-size:.85rem;margin-left:.5rem">${post.date||''}</span>
             </div>
             <div class="markdown-body">${html}</div>`;
        document.getElementById('postReadModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeReadModal() {
        document.getElementById('postReadModal').style.display = 'none';
        document.body.style.overflow = '';
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê´€ë¦¬ì ë¡œê·¸ì¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openAdminLogin() {
        if (isAdmin) { logoutAdmin(); return; }
        document.getElementById('adminLoginStep1').style.display = 'block';
        document.getElementById('adminLoginStep2').style.display = 'none';
        document.getElementById('adminPwInput').value = '';
        document.getElementById('adminPwError').style.display = 'none';
        document.getElementById('adminLoginModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        setTimeout(() => document.getElementById('adminPwInput').focus(), 100);
    }

    function closeAdminLogin() {
        document.getElementById('adminLoginModal').style.display = 'none';
        document.body.style.overflow = '';
    }

    async function verifyPassword() {
        if (ADMIN_PW_HASH === 'SETUP_REQUIRED') {
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì•„ì§ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nClaudeì—ê²Œ "íˆ¬ìë©”ëª¨ ë¹„ë°€ë²ˆí˜¸ë¥¼ [ë¹„ë°€ë²ˆí˜¸]ë¡œ ì„¤ì •í•´ì¤˜" ë¼ê³  í•´ì£¼ì„¸ìš”.');
            return;
        }
        const pw = document.getElementById('adminPwInput').value;
        const hash = await sha256(pw);
        if (hash === ADMIN_PW_HASH) {
            document.getElementById('adminPwError').style.display = 'none';
            document.getElementById('adminLoginStep1').style.display = 'none';
            document.getElementById('adminLoginStep2').style.display = 'block';
            // ì €ì¥ëœ PAT/Repo ë³µì›
            const savedPat = sessionStorage.getItem('admin_pat');
            const savedRepo = sessionStorage.getItem('admin_repo');
            if (savedPat) document.getElementById('adminPatInput').value = savedPat;
            if (savedRepo) document.getElementById('adminRepoInput').value = savedRepo;
            setTimeout(() => document.getElementById('adminPatInput').focus(), 100);
        } else {
            document.getElementById('adminPwError').style.display = 'block';
            document.getElementById('adminPwInput').value = '';
            document.getElementById('adminPwInput').focus();
        }
    }

    async function loginWithPat() {
        const pat = document.getElementById('adminPatInput').value.trim();
        const repo = document.getElementById('adminRepoInput').value.trim();
        if (!pat || !repo || !repo.includes('/')) {
            document.getElementById('adminPatError').style.display = 'block';
            return;
        }
        // PAT ìœ íš¨ì„± ê°„ë‹¨ í™•ì¸ (ì €ì¥ì†Œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸)
        try {
            const res = await fetch(`https://api.github.com/repos/${repo}`, {
                headers: { 'Authorization': `token ${pat}`, 'Accept': 'application/vnd.github+json' }
            });
            if (!res.ok) throw new Error('ì ‘ê·¼ ì‹¤íŒ¨');
        } catch(e) {
            document.getElementById('adminPatError').style.display = 'block';
            document.getElementById('adminPatError').textContent = 'PAT ë˜ëŠ” ì €ì¥ì†Œ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”. (ì˜¤ë¥˜: ' + e.message + ')';
            return;
        }
        adminPat = pat;
        adminRepo = repo;
        sessionStorage.setItem('admin_pat', pat);
        sessionStorage.setItem('admin_repo', repo);
        isAdmin = true;
        closeAdminLogin();
        document.getElementById('adminLockBtn').textContent = 'ğŸ”“';
        document.getElementById('adminLockBtn').title = 'ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ';
        document.getElementById('adminNewPostBtn').style.display = 'inline-flex';
        renderPosts(); // Admin ë²„íŠ¼ í‘œì‹œë¥¼ ìœ„í•´ ì¬ë Œë”ë§
    }

    function logoutAdmin() {
        isAdmin = false;
        adminPat = null;
        adminRepo = null;
        sessionStorage.removeItem('admin_pat');
        sessionStorage.removeItem('admin_repo');
        document.getElementById('adminLockBtn').textContent = 'ğŸ”’';
        document.getElementById('adminLockBtn').title = 'ê´€ë¦¬ì ë¡œê·¸ì¸';
        document.getElementById('adminNewPostBtn').style.display = 'none';
        renderPosts();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê¸€ ì‘ì„±/ìˆ˜ì • ì—ë””í„°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openPostEditor(id = null) {
        document.getElementById('editPostId').value = id || '';
        document.getElementById('editorSaveError').style.display = 'none';
        document.getElementById('editorSaveBtn').disabled = false;

        if (id) {
            const post = allPosts.find(p => String(p.id) === String(id));
            if (!post) return;
            document.getElementById('editorTitle').textContent = 'ê¸€ ìˆ˜ì •';
            document.getElementById('editIcon').value = post.icon || 'ğŸ“';
            document.getElementById('editTag').value = post.tag || '';
            document.getElementById('editTitleInput').value = post.title || '';
            document.getElementById('editContent').value = post.content || '';
        } else {
            document.getElementById('editorTitle').textContent = 'ìƒˆ ê¸€ ì“°ê¸°';
            document.getElementById('editIcon').value = 'ğŸ“';
            document.getElementById('editTag').value = '';
            document.getElementById('editTitleInput').value = '';
            document.getElementById('editContent').value = '';
        }
        switchEditorTab('write');
        document.getElementById('postEditorModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        setTimeout(() => document.getElementById('editTitleInput').focus(), 100);
    }

    function closePostEditor() {
        document.getElementById('postEditorModal').style.display = 'none';
        document.body.style.overflow = '';
    }

    function switchEditorTab(tab) {
        const textarea = document.getElementById('editContent');
        const preview = document.getElementById('editPreview');
        const tabWrite = document.getElementById('tabWrite');
        const tabPreview = document.getElementById('tabPreview');
        if (tab === 'write') {
            textarea.style.display = 'block';
            preview.style.display = 'none';
            tabWrite.classList.add('active');
            tabPreview.classList.remove('active');
        } else {
            const html = marked.parse(textarea.value || '');
            preview.innerHTML = '<div class="markdown-body">' + html + '</div>';
            textarea.style.display = 'none';
            preview.style.display = 'block';
            tabWrite.classList.remove('active');
            tabPreview.classList.add('active');
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // GitHub API: posts.json ì €ì¥
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function getFileSha() {
        const res = await fetch(`https://api.github.com/repos/${adminRepo}/contents/data/posts.json`, {
            headers: { 'Authorization': `token ${adminPat}`, 'Accept': 'application/vnd.github+json' }
        });
        if (!res.ok) return null;
        const json = await res.json();
        return json.sha;
    }

    async function savePostsToGithub(posts, commitMsg) {
        const sha = await getFileSha();
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(posts, null, 2))));
        const body = { message: commitMsg, content };
        if (sha) body.sha = sha;
        const res = await fetch(`https://api.github.com/repos/${adminRepo}/contents/data/posts.json`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${adminPat}`,
                'Accept': 'application/vnd.github+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
        });
        if (!res.ok) {
            const err = await res.json();
            throw new Error(err.message || 'GitHub ì €ì¥ ì‹¤íŒ¨');
        }
        return true;
    }

    async function savePost() {
        const id = document.getElementById('editPostId').value;
        const icon = document.getElementById('editIcon').value.trim() || 'ğŸ“';
        const tag = document.getElementById('editTag').value.trim();
        const title = document.getElementById('editTitleInput').value.trim();
        const content = document.getElementById('editContent').value.trim();

        if (!title) { showEditorError('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        if (!content) { showEditorError('ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }

        const saveBtn = document.getElementById('editorSaveBtn');
        saveBtn.disabled = true;
        saveBtn.textContent = 'ì €ì¥ ì¤‘...';

        try {
            const today = new Date().toISOString().slice(0, 10);
            let posts = [...allPosts];

            if (id) {
                // ìˆ˜ì •
                const idx = posts.findIndex(p => String(p.id) === String(id));
                if (idx >= 0) {
                    posts[idx] = { ...posts[idx], icon, tag, title, content };
                }
            } else {
                // ì‹ ê·œ
                const newPost = {
                    id: String(Date.now()),
                    title, tag, icon, date: today, content
                };
                posts.unshift(newPost);
            }

            await savePostsToGithub(posts, id ? `Update post: ${title}` : `Add post: ${title}`);
            allPosts = posts;
            closePostEditor();
            renderPosts();
        } catch(e) {
            showEditorError('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
        } finally {
            saveBtn.disabled = false;
            saveBtn.textContent = 'ì €ì¥ (GitHub ì—…ë¡œë“œ)';
        }
    }

    function showEditorError(msg) {
        const el = document.getElementById('editorSaveError');
        el.textContent = msg;
        el.style.display = 'block';
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê¸€ ì‚­ì œ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openDeleteConfirm(id, title) {
        deleteTargetId = id;
        document.getElementById('deleteConfirmMsg').textContent = `"${title}" ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)`;
        document.getElementById('deleteConfirmModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteConfirm() {
        deleteTargetId = null;
        document.getElementById('deleteConfirmModal').style.display = 'none';
        document.body.style.overflow = '';
    }

    async function confirmDelete() {
        if (!deleteTargetId) return;
        const post = allPosts.find(p => String(p.id) === String(deleteTargetId));
        const posts = allPosts.filter(p => String(p.id) !== String(deleteTargetId));
        try {
            await savePostsToGithub(posts, `Delete post: ${post ? post.title : deleteTargetId}`);
            allPosts = posts;
            closeDeleteConfirm();
            renderPosts();
        } catch(e) {
            alert('ì‚­ì œ ì‹¤íŒ¨: ' + e.message);
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì´ˆê¸° ë¡œë“œ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', () => {
        loadPosts();
    });
    </script>

    <script>
    // â”€â”€â”€ ì£¼ì‹ì‹œì¥ ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const CHART_COLORS = {
        kospi:  { line: '#667eea', fill: 'rgba(102,126,234,0.08)' },
        sp500:  { line: '#f093fb', fill: 'rgba(240,147,251,0.08)' },
        kosdaq: { line: '#43e97b', fill: 'rgba(67,233,123,0.08)' },
        qqq:    { line: '#fa8231', fill: 'rgba(250,130,49,0.08)'  }
    };

    // Yahoo Finance v8 API í˜¸ì¶œ
    async function fetchYahoo(symbol) {
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}?interval=1d&range=1y`;
        try {
            const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const json = await res.json();
            const result = json?.chart?.result?.[0];
            if (!result) throw new Error('ë°ì´í„° ì—†ìŒ');

            const timestamps = result.timestamp;
            const closes = result.indicators.quote[0].close;
            const rows = [];
            for (let i = 0; i < timestamps.length; i++) {
                if (closes[i] != null) {
                    rows.push({
                        date: new Date(timestamps[i] * 1000).toISOString().slice(0, 10),
                        close: closes[i]
                    });
                }
            }
            return rows;
        } catch (e) {
            return null;
        }
    }

    // ë¡œì»¬ CSV íŒŒì‹±
    async function loadCSV(path) {
        try {
            const res = await fetch(path);
            if (!res.ok) throw new Error('CSV ë¡œë“œ ì‹¤íŒ¨');
            const text = await res.text();
            const lines = text.trim().split('\n');
            const rows = [];
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length >= 5 && cols[4]) {
                    rows.push({
                        date: cols[0].trim().slice(0, 10),
                        close: parseFloat(cols[4])
                    });
                }
            }
            return rows.slice(-252); // ìµœê·¼ 1ë…„(ì•½ 252 ê±°ë˜ì¼)
        } catch (e) {
            return null;
        }
    }

    // ë°ì´í„° ë¡œë“œ (Yahoo ìš°ì„ , CSV fallback)
    async function loadData(symbol, csvPath) {
        let data = await fetchYahoo(symbol);
        if (!data && csvPath) {
            data = await loadCSV(csvPath);
        }
        return data;
    }

    // ì°¨íŠ¸ ë Œë”ë§
    function renderChart(canvasId, data, color) {
        const ctx = document.getElementById(canvasId);
        if (!ctx) return;

        // xì¶• ë ˆì´ë¸”: ë§¤ì›” 1ì¼ ê·¼ì²˜ë§Œ í‘œì‹œ
        const labels = data.map(d => d.date);
        const values = data.map(d => d.close);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    data: values,
                    borderColor: color.line,
                    backgroundColor: color.fill,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    pointHoverBackgroundColor: color.line
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: (items) => items[0].label,
                            label: (item) => {
                                const val = item.raw;
                                return val >= 1000
                                    ? val.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
                                    : val.toLocaleString('ko-KR', { maximumFractionDigits: 2 });
                            }
                        },
                        backgroundColor: 'rgba(0,0,0,0.75)',
                        padding: 10,
                        cornerRadius: 6
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: 6,
                            maxRotation: 0,
                            color: '#999',
                            font: { size: 11 },
                            callback: function(val, idx) {
                                // ì›” ì²« ë²ˆì§¸ ë°ì´í„°ë§Œ í‘œì‹œ
                                const label = this.getLabelForValue(val);
                                const prev = idx > 0 ? this.getLabelForValue(idx - 1) : null;
                                if (!prev || label.slice(0, 7) !== prev.slice(0, 7)) {
                                    return label.slice(5, 7) + 'ì›”'; // MMì›”
                                }
                                return '';
                            }
                        },
                        border: { display: false }
                    },
                    y: {
                        grid: {
                            color: 'rgba(0,0,0,0.05)',
                            drawTicks: false
                        },
                        ticks: {
                            color: '#999',
                            font: { size: 11 },
                            maxTicksLimit: 4,
                            callback: (val) => val >= 1000
                                ? (val / 1000).toFixed(1) + 'k'
                                : val.toFixed(0)
                        },
                        border: { display: false }
                    }
                }
            }
        });
    }

    // í†µê³„ ì—…ë°ì´íŠ¸ (ìµœì‹  ê°€ê²©, ë“±ë½)
    function updateStats(priceId, changeId, dateId, data) {
        if (!data || data.length < 2) {
            document.getElementById(priceId).textContent = 'ë°ì´í„° ì—†ìŒ';
            return;
        }
        const last = data[data.length - 1];
        const prev = data[data.length - 2];
        const diff = last.close - prev.close;
        const pct  = (diff / prev.close) * 100;

        const priceEl  = document.getElementById(priceId);
        const changeEl = document.getElementById(changeId);
        const dateEl   = document.getElementById(dateId);

        const fmtClose = last.close >= 1000
            ? last.close.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
            : last.close.toLocaleString('ko-KR', { maximumFractionDigits: 2 });

        priceEl.textContent = fmtClose;

        const sign = diff >= 0 ? '+' : '';
        const fmtDiff = diff >= 1000 || diff <= -1000
            ? sign + diff.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
            : sign + diff.toFixed(2);
        changeEl.textContent = `${fmtDiff} (${sign}${pct.toFixed(2)}%)`;
        changeEl.className = 'chart-change ' + (diff >= 0 ? 'up' : 'down');

        if (dateEl) dateEl.textContent = `ê¸°ì¤€: ${last.date}`;
    }

    // ë¡œë”© ìƒíƒœ ì²˜ë¦¬
    function hideLoading(loadingId) {
        const el = document.getElementById(loadingId);
        if (el) el.style.display = 'none';
    }

    function showError(loadingId, msg) {
        const el = document.getElementById(loadingId);
        if (el) { el.textContent = msg; el.classList.add('error'); }
    }

    // ë©”ì¸ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', async () => {
        const indices = [
            {
                symbol: '^KS11',
                csv: 'data/chapter8/fdr_INDEX_p1d_KS11.csv',
                canvasId: 'kospiChart',
                color: CHART_COLORS.kospi,
                priceId: 'kospiPrice', changeId: 'kospiChange',
                dateId: 'kospiDate', loadingId: 'kospiLoading'
            },
            {
                symbol: '^GSPC',
                csv: 'data/chapter8/fdr_INDEX_p1d_US-SnP500.csv',
                canvasId: 'sp500Chart',
                color: CHART_COLORS.sp500,
                priceId: 'sp500Price', changeId: 'sp500Change',
                dateId: 'sp500Date', loadingId: 'sp500Loading'
            },
            {
                symbol: '^KQ11',
                csv: 'data/chapter8/fdr_INDEX_p1d_KQ11.csv',
                canvasId: 'kosdaqChart',
                color: CHART_COLORS.kosdaq,
                priceId: 'kosdaqPrice', changeId: 'kosdaqChange',
                dateId: 'kosdaqDate', loadingId: 'kosdaqLoading'
            },
            {
                symbol: 'QQQ',
                csv: 'data/chapter8/fdr_INDEX_p1d_QQQ.csv',
                canvasId: 'qqqChart',
                color: CHART_COLORS.qqq,
                priceId: 'qqqPrice', changeId: 'qqqChange',
                dateId: 'qqqDate', loadingId: 'qqqLoading'
            }
        ];

        await Promise.all(indices.map(async (idx) => {
            const data = await loadData(idx.symbol, idx.csv);
            hideLoading(idx.loadingId);
            if (data && data.length > 0) {
                renderChart(idx.canvasId, data, idx.color);
                updateStats(idx.priceId, idx.changeId, idx.dateId, data);
            } else {
                showError(idx.loadingId, 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                document.getElementById(idx.priceId).textContent = 'â€”';
                document.getElementById(idx.changeId).textContent = 'â€”';
            }
        }));
    });
    </script>
</body>
</html>
