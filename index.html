<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>머신러너 - Machine Learner | AI 주식투자</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- 상단 네비게이션 바 -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="#hero" class="nav-brand">
                <img src="logo.png" alt="Machine Learner Logo" class="nav-logo">
                <span class="nav-brand-text">머신러너</span>
            </a>

            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <div class="nav-links">
                <a href="#market" class="nav-link">주식시장</a>
                <a href="#downloads" class="nav-link">데이터 다운로드</a>
                <a href="#ai-prompts" class="nav-link">AI 프롬프트</a>
                <a href="#book-updates" class="nav-link">도서개정</a>
                <a href="#ai-updates" class="nav-link">AI 소식</a>
                <a href="#insights" class="nav-link">투자 메모</a>
                <a href="#contact" class="nav-link">Contact</a>
            </div>
        </div>
    </nav>

    <main>
        <!-- 히어로 섹션 (최상단) -->
        <section id="hero" class="hero">
            <div class="container">
                <h2>AI 주식투자</h2>
                <p class="subtitle">
                    머신러닝과 인공지능을 활용한 데이터 기반 투자 전략 구축<br>
                    9개 챕터로 배우는 실전 AI 투자 시스템
                </p>
            </div>
        </section>

        <!-- 주식시장 섹션 -->
        <section id="market" class="market">
            <div class="container">
                <h3>주식시장</h3>
                <p class="section-description">한국과 미국 주요 지수의 최근 1년 흐름을 확인하세요.</p>

                <div class="market-grid">
                    <!-- KOSPI -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label korea">한국</span>
                                <h4 class="chart-name">KOSPI</h4>
                            </div>
                            <div class="chart-stats" id="kospiStats">
                                <span class="chart-price" id="kospiPrice">—</span>
                                <span class="chart-change" id="kospiChange">—</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="kospiChart"></canvas>
                            <div class="chart-loading" id="kospiLoading">데이터 로딩 중...</div>
                        </div>
                        <div class="chart-footer" id="kospiDate">—</div>
                    </div>

                    <!-- S&P 500 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label us">미국</span>
                                <h4 class="chart-name">S&P 500</h4>
                            </div>
                            <div class="chart-stats" id="sp500Stats">
                                <span class="chart-price" id="sp500Price">—</span>
                                <span class="chart-change" id="sp500Change">—</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="sp500Chart"></canvas>
                            <div class="chart-loading" id="sp500Loading">데이터 로딩 중...</div>
                        </div>
                        <div class="chart-footer" id="sp500Date">—</div>
                    </div>

                    <!-- KOSDAQ -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label korea">한국</span>
                                <h4 class="chart-name">KOSDAQ</h4>
                            </div>
                            <div class="chart-stats" id="kosdaqStats">
                                <span class="chart-price" id="kosdaqPrice">—</span>
                                <span class="chart-change" id="kosdaqChange">—</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="kosdaqChart"></canvas>
                            <div class="chart-loading" id="kosdaqLoading">데이터 로딩 중...</div>
                        </div>
                        <div class="chart-footer" id="kosdaqDate">—</div>
                    </div>

                    <!-- QQQ -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-group">
                                <span class="market-label us">미국</span>
                                <h4 class="chart-name">QQQ</h4>
                            </div>
                            <div class="chart-stats" id="qqqStats">
                                <span class="chart-price" id="qqqPrice">—</span>
                                <span class="chart-change" id="qqqChange">—</span>
                            </div>
                        </div>
                        <div class="chart-wrap">
                            <canvas id="qqqChart"></canvas>
                            <div class="chart-loading" id="qqqLoading">데이터 로딩 중...</div>
                        </div>
                        <div class="chart-footer" id="qqqDate">—</div>
                    </div>
                </div>

                <p class="market-note">* 데이터 출처: Yahoo Finance. 실시간이 아닐 수 있습니다.</p>
            </div>
        </section>

        <!-- 데이터 다운로드 섹션 -->
        <section id="downloads" class="downloads">
            <div class="container">
                <h3>데이터 다운로드</h3>
                <p class="download-description">
                    책에서 사용된 데이터셋과 코드를 다운로드하실 수 있습니다.
                </p>

                <div class="download-grid">
                    <div class="download-card">
                        <h4>📚 장별 실습 제공</h4>
                        <p>9개 챕터별 데이터 & AI 프롬프트</p>
                        <a href="chapters.html" class="download-btn">학습 시작</a>
                    </div>

                    <div class="download-card">
                        <h4>📊 한국 주식 가격 데이터</h4>
                        <p>2,500+ 종목의 OHLCV 데이터 (월간 / 일간)</p>
                        <a href="krx-ohlcv.html" class="download-btn">다운로드</a>
                    </div>

                    <div class="download-card">
                        <h4>📈 한국 주식 퀀트 데이터</h4>
                        <p>재무제표, 밸류에이션 등 (준비중)</p>
                        <span class="badge-coming-soon">준비중</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI 프롬프트 섹션 -->
        <section id="ai-prompts" class="ai-prompts">
            <div class="container">
                <h3>AI 프롬프트</h3>
                <p class="section-description">
                    각 챕터별 AI 학습을 위한 프롬프트를 제공합니다.
                </p>

                <div class="prompt-grid">
                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 1-3</span>
                        <h4>기초 & 데이터 수집</h4>
                        <p>육하원칙, 의사결정, 호재악재</p>
                        <div class="prompt-meta">
                            <span>💬 9개 프롬프트</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">프롬프트 보기 →</a>
                    </div>

                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 4-6</span>
                        <h4>AI 모델링 & 포트폴리오</h4>
                        <p>재무제표, 투자멘토, 안전마진</p>
                        <div class="prompt-meta">
                            <span>💬 12개 프롬프트</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">프롬프트 보기 →</a>
                    </div>

                    <div class="prompt-card">
                        <span class="chapter-badge">Chapter 7-9</span>
                        <h4>고급 분석 & 시스템 구축</h4>
                        <p>딥리서치, 백테스트, 에이전트</p>
                        <div class="prompt-meta">
                            <span>💬 14개 프롬프트</span>
                        </div>
                        <a href="chapters.html" class="prompt-link">프롬프트 보기 →</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 실시간 도서개정 섹션 -->
        <section id="book-updates" class="book-updates">
            <div class="container">
                <h3>도서개정</h3>
                <p class="section-description">
                    도서의 최신 업데이트 내역을 확인하세요.
                </p>

                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">2025.01.15</div>
                        <div class="timeline-content">
                            <h4>Chapter 3 호재악재 섹션 업데이트</h4>
                            <p>뉴스 감성분석 프롬프트 추가 및 예제 코드 개선</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2024.12.20</div>
                        <div class="timeline-content">
                            <h4>새로운 AI 프롬프트 추가</h4>
                            <p>전 챕터에 ChatGPT/Claude 활용 프롬프트 10개 추가</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-date">2024.11.01</div>
                        <div class="timeline-content">
                            <h4>초판 출간</h4>
                            <p>머신러너 - AI 주식투자 도서 출간</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI 소식 섹션 -->
        <section id="ai-updates" class="ai-updates">
            <div class="container">
                <h3>AI 소식</h3>
                <p class="section-description">
                    최신 AI 기술과 모델 업데이트를 확인하세요.
                </p>

                <div class="update-list">
                    <div class="update-item">
                        <span class="date">2025.01</span>
                        <span class="content">GPT-4 Turbo 프롬프트 최적화 가이드 추가</span>
                    </div>
                    <div class="update-item">
                        <span class="date">2024.12</span>
                        <span class="content">Claude 3.5 Sonnet을 활용한 재무제표 분석 예제</span>
                    </div>
                    <div class="update-item">
                        <span class="date">2024.11</span>
                        <span class="content">웹사이트 오픈</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 투자 메모 섹션 -->
        <section id="insights" class="insights">
            <div class="container">
                <h3>투자 메모</h3>
                <p class="section-description">
                    AI 주식투자 전문가의 노하우와 인사이트를 공유합니다.
                </p>

                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-icon">🤖</div>
                        <h4>AI 모델 선택 가이드</h4>
                        <p>LSTM vs Transformer: 주가 예측에 적합한 모델은?</p>
                        <div class="insight-footer">
                            <span class="insight-tag">AI 모델링</span>
                            <span class="insight-read-time">5분 읽기</span>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-icon">⚠️</div>
                        <h4>백테스팅 함정</h4>
                        <p>백테스팅에서 놓치기 쉬운 3가지 함정과 해결 방법</p>
                        <div class="insight-footer">
                            <span class="insight-tag">백테스팅</span>
                            <span class="insight-read-time">7분 읽기</span>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-icon">📊</div>
                        <h4>뉴스 감성분석</h4>
                        <p>뉴스 감성분석으로 시장 심리 파악하기</p>
                        <div class="insight-footer">
                            <span class="insight-tag">데이터 분석</span>
                            <span class="insight-read-time">6분 읽기</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact 섹션 -->
        <section id="contact" class="contact">
            <div class="container">
                <h3>Contact</h3>
                <p class="section-description">
                    문의사항이 있으시면 언제든 연락해주세요.
                </p>

                <div class="contact-card">
                    <div class="contact-icon">✉️</div>
                    <h4>이메일 문의</h4>
                    <p>데이터, 도서, 강의 관련 문의는 이메일로 보내주세요.</p>
                    <a href="mailto:machinelearner@example.com" class="contact-btn">machinelearner@example.com</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 머신러너 (Machine Learner). All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
    // ─── 주식시장 차트 ────────────────────────────────────────────

    const CHART_COLORS = {
        kospi:  { line: '#667eea', fill: 'rgba(102,126,234,0.08)' },
        sp500:  { line: '#f093fb', fill: 'rgba(240,147,251,0.08)' },
        kosdaq: { line: '#43e97b', fill: 'rgba(67,233,123,0.08)' },
        qqq:    { line: '#fa8231', fill: 'rgba(250,130,49,0.08)'  }
    };

    // Yahoo Finance v8 API 호출
    async function fetchYahoo(symbol) {
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(symbol)}?interval=1d&range=1y`;
        try {
            const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const json = await res.json();
            const result = json?.chart?.result?.[0];
            if (!result) throw new Error('데이터 없음');

            const timestamps = result.timestamp;
            const closes = result.indicators.quote[0].close;
            const rows = [];
            for (let i = 0; i < timestamps.length; i++) {
                if (closes[i] != null) {
                    rows.push({
                        date: new Date(timestamps[i] * 1000).toISOString().slice(0, 10),
                        close: closes[i]
                    });
                }
            }
            return rows;
        } catch (e) {
            return null;
        }
    }

    // 로컬 CSV 파싱
    async function loadCSV(path) {
        try {
            const res = await fetch(path);
            if (!res.ok) throw new Error('CSV 로드 실패');
            const text = await res.text();
            const lines = text.trim().split('\n');
            const rows = [];
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length >= 5 && cols[4]) {
                    rows.push({
                        date: cols[0].trim().slice(0, 10),
                        close: parseFloat(cols[4])
                    });
                }
            }
            return rows.slice(-252); // 최근 1년(약 252 거래일)
        } catch (e) {
            return null;
        }
    }

    // 데이터 로드 (Yahoo 우선, CSV fallback)
    async function loadData(symbol, csvPath) {
        let data = await fetchYahoo(symbol);
        if (!data && csvPath) {
            data = await loadCSV(csvPath);
        }
        return data;
    }

    // 차트 렌더링
    function renderChart(canvasId, data, color) {
        const ctx = document.getElementById(canvasId);
        if (!ctx) return;

        // x축 레이블: 매월 1일 근처만 표시
        const labels = data.map(d => d.date);
        const values = data.map(d => d.close);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    data: values,
                    borderColor: color.line,
                    backgroundColor: color.fill,
                    borderWidth: 2,
                    fill: true,
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    pointHoverBackgroundColor: color.line
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: (items) => items[0].label,
                            label: (item) => {
                                const val = item.raw;
                                return val >= 1000
                                    ? val.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
                                    : val.toLocaleString('ko-KR', { maximumFractionDigits: 2 });
                            }
                        },
                        backgroundColor: 'rgba(0,0,0,0.75)',
                        padding: 10,
                        cornerRadius: 6
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: 6,
                            maxRotation: 0,
                            color: '#999',
                            font: { size: 11 },
                            callback: function(val, idx) {
                                // 월 첫 번째 데이터만 표시
                                const label = this.getLabelForValue(val);
                                const prev = idx > 0 ? this.getLabelForValue(idx - 1) : null;
                                if (!prev || label.slice(0, 7) !== prev.slice(0, 7)) {
                                    return label.slice(5, 7) + '월'; // MM월
                                }
                                return '';
                            }
                        },
                        border: { display: false }
                    },
                    y: {
                        grid: {
                            color: 'rgba(0,0,0,0.05)',
                            drawTicks: false
                        },
                        ticks: {
                            color: '#999',
                            font: { size: 11 },
                            maxTicksLimit: 4,
                            callback: (val) => val >= 1000
                                ? (val / 1000).toFixed(1) + 'k'
                                : val.toFixed(0)
                        },
                        border: { display: false }
                    }
                }
            }
        });
    }

    // 통계 업데이트 (최신 가격, 등락)
    function updateStats(priceId, changeId, dateId, data) {
        if (!data || data.length < 2) {
            document.getElementById(priceId).textContent = '데이터 없음';
            return;
        }
        const last = data[data.length - 1];
        const prev = data[data.length - 2];
        const diff = last.close - prev.close;
        const pct  = (diff / prev.close) * 100;

        const priceEl  = document.getElementById(priceId);
        const changeEl = document.getElementById(changeId);
        const dateEl   = document.getElementById(dateId);

        const fmtClose = last.close >= 1000
            ? last.close.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
            : last.close.toLocaleString('ko-KR', { maximumFractionDigits: 2 });

        priceEl.textContent = fmtClose;

        const sign = diff >= 0 ? '+' : '';
        const fmtDiff = diff >= 1000 || diff <= -1000
            ? sign + diff.toLocaleString('ko-KR', { maximumFractionDigits: 0 })
            : sign + diff.toFixed(2);
        changeEl.textContent = `${fmtDiff} (${sign}${pct.toFixed(2)}%)`;
        changeEl.className = 'chart-change ' + (diff >= 0 ? 'up' : 'down');

        if (dateEl) dateEl.textContent = `기준: ${last.date}`;
    }

    // 로딩 상태 처리
    function hideLoading(loadingId) {
        const el = document.getElementById(loadingId);
        if (el) el.style.display = 'none';
    }

    function showError(loadingId, msg) {
        const el = document.getElementById(loadingId);
        if (el) { el.textContent = msg; el.classList.add('error'); }
    }

    // 메인 실행
    window.addEventListener('DOMContentLoaded', async () => {
        const indices = [
            {
                symbol: '^KS11',
                csv: 'data/chapter8/fdr_INDEX_p1d_KS11.csv',
                canvasId: 'kospiChart',
                color: CHART_COLORS.kospi,
                priceId: 'kospiPrice', changeId: 'kospiChange',
                dateId: 'kospiDate', loadingId: 'kospiLoading'
            },
            {
                symbol: '^GSPC',
                csv: 'data/chapter8/fdr_INDEX_p1d_US-SnP500.csv',
                canvasId: 'sp500Chart',
                color: CHART_COLORS.sp500,
                priceId: 'sp500Price', changeId: 'sp500Change',
                dateId: 'sp500Date', loadingId: 'sp500Loading'
            },
            {
                symbol: '^KQ11',
                csv: 'data/chapter8/fdr_INDEX_p1d_KQ11.csv',
                canvasId: 'kosdaqChart',
                color: CHART_COLORS.kosdaq,
                priceId: 'kosdaqPrice', changeId: 'kosdaqChange',
                dateId: 'kosdaqDate', loadingId: 'kosdaqLoading'
            },
            {
                symbol: 'QQQ',
                csv: 'data/chapter8/fdr_INDEX_p1d_QQQ.csv',
                canvasId: 'qqqChart',
                color: CHART_COLORS.qqq,
                priceId: 'qqqPrice', changeId: 'qqqChange',
                dateId: 'qqqDate', loadingId: 'qqqLoading'
            }
        ];

        await Promise.all(indices.map(async (idx) => {
            const data = await loadData(idx.symbol, idx.csv);
            hideLoading(idx.loadingId);
            if (data && data.length > 0) {
                renderChart(idx.canvasId, data, idx.color);
                updateStats(idx.priceId, idx.changeId, idx.dateId, data);
            } else {
                showError(idx.loadingId, '데이터를 불러올 수 없습니다');
                document.getElementById(idx.priceId).textContent = '—';
                document.getElementById(idx.changeId).textContent = '—';
            }
        }));
    });
    </script>
</body>
</html>
